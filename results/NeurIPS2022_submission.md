# The Experiments for NeurIPS 2022 Submission

## Scenarios

- Case 1 data center on demand: 
  - 8 X p3.16xlarge (8 V100)
  - Intra-instance bandwidth 100 Gbps
  - Inter-instance bandwidth 25 Gbps
- Case 2 data center spot: 
  - 8 * p3.8xlarge(4 V100) + 32 p3.2xlarge (1 V100)
  - Intra-instance bandwidth 100 Gbps
  - Inter-instance bandwidth 10 Gbps
- Case 3 Multiple universities: 
  - 2 universities (each has 32 V100 GPUs)
  - With in each university bandwidth: 5 Gbps 
  - Connection between regions: 1.2 Gbps
- Case 4 Regional distributed: 
  - 4 regions in Europe 
  - Within each region: 2 Gbps 
  - across different region 8: 1.0 ~ 1.2 Gbps
- Case 5 World-wide distributed: 
  - 8 regions around the work 
  - Within each region: 2 Gbps
  - Across different region 0.3 ~ 1.2 Gbps


## Compare Group

Four settings:
- (a). Megatron-Optimal 
- (b). Megatron-PP
- (c). Ours with Scheduler
- (d). Ours without Scheduler

Report:
- End-to-end: (a) vs (c) all scenarios 
- Effectiveness of scheduler: (c) vs (d) vs (b) all scenarios
- Effectiveness of system implementation: (b) vs (d) in homogeneous TC

Shared settings (GPT-XL):
- Switching total layers: 24, 32, 40
- Switching batch sizes: 1024, 2048, 4096
- Sequence length: 2048
- Micro-batch size: 1
- fp16
- The PFlop for each setting:

|            | Layer 24 | Layer 32 | Layer 40 |
|------------|----------|----------|----------|
| Batch 1024 | 23.64    | 31.52    | 39.41    |
| Batch 2048 | 47.28    | 63.04    | 78.82    |
| Batch 4096 | 94.56    | 126.08   | 157.64   |

- Additional PFLOP:
  - Batch 1024 GPT3-6.7B 117.12
  - Batch

## Case 1 Data Center on Demand

- Notes:
  - Use aws_run_gpt3_Ngpu_training.sh for ours w scheduler; 
  - Use aws_run_gpt3_scheduled_Ngpu_training.sh for ours wo scheduler;
  - Use aws_run_megatron_training.sh for different Megatron Settings.
  
- One iteration runtime (in seconds):

| Setting   | Megatron-P8 | Megatron-T8 | Megatron-P2T4 | Megatron-P4T2 |        |        | Ours w scheduler |        |        | Ours wo Scheduler |        |        | ZeRO S3 |         |         | Deepspeed PP |       |       |
|-----------|-------------|-------------|---------------|---------------|--------|--------|------------------|--------|--------|-------------------|--------|--------|---------|---------|---------|--------------|-------|-------|
| Seed      | -           | -           | -             | 2022          | 2023   | 2024   | 2022             | 2023   | 2024   | 2022              | 2023   | 2024   | 2022    | 2023    | 2024    | 2022         | 2023  | 2024  |
| L24 B1024 | 24.34       | 25.04       | 14.25         | 12.52         | 12.55  | 12.54  | 10.14            | 10.21  | 10.08  | 20.27             | 19.46  | 20.19  | 14.69   | 14.80   | 14.72   | 20.85        | 19.91 | 20.55 |
| L24 B2048 | 50.73       | -           | -             | 24.70         | 24.71  | 24.66  | 17.62            | 17.63  | 17.81  | 33.25             | 32.32  | 33.10  | 28.83   | 28.87   | 28.34   | 40.29        | 41.53 | 39.93 |
| L24 B4096 | 101.79      | -           | -             | 48.91         | 48.76  | 48.85  | 32.99            | 32.98  | 33.19  | 65.78             | 67.13  | 66.43  | 59.58   | 57.91   | 58.34   | 77.40        | 77.64 | 78.17 |
| L32 B1024 | 26.80       | 32.59       | 18.44         | 15.38         | 15.43  | 15.30  | 13.33            | 13.24  | 13.13  | 23.09             | 24.72  | 22.12  | 25.43   | 25.94   | 24.56   | 22.56        | 22.40 | 22.63 |
| L32 B2048 | 53.45       | -           | -             | 30.51         | 30.31  | 30.62  | 23.22            | 23.21  | 23.12  | 39.43             | 40.25  | 39.29  | 46.29   | 46.67   | 46.10   | 44.46        | 44.79 | 45.19 |
| L32 B4096 | 106.82      | -           | -             | 60.32         | 60.39  | 60.31  | 43.10            | 43.34  | 43.18  | 78.47             | 79.06  | 79.59  | 89.57   | 90.83   | 91.45   | 81.69        | 81.63 | 82.07 |
| L40 B1024 | 28.62       | 40.46       | 22.60         | 18.88         | 18.77  | 18.60  | 16.70            | 16.68  | 16.65  | 24.48             | 25.51  | 23.04  | 38.55   | 38.08   | 38.52   | 23.76        | 23.85 | 23.98 |
| L40 B2048 | 56.78       | -           | -             | 36.87         | 36.89  | 36.86  | 29.58            | 29.51  | 29.42  | 44.71             | 44.44  | 43.80  | 73.95   | 73.43   | 74.57   | 47.96        | 48.68 | 47.92 |
| L40 B4096 | 111.58      | -           | -             | 72.96         | 72.93  | 72.88  | 53.80            | 53.76  | 53.84  | 88.74             | 88.71  | 88.60  | 149.62  | 146.22  | 149.64  | 88.73        | 88.00 | 88.10 | 


- Hardware Efficiency (by PFlops):

| Setting   | Megatron-PP | Megatron-Opt | Ours w scheduler | Ours wo Scheduler | ZeRO S3 | Deepspeed |
|-----------|-------------|--------------|------------------|-------------------|---------|-----------|
| L24 B1024 | 0.971       | 1.888        | 2.331            | 1.166             | 1.604   | 1.157     |
| L24 B2048 | 0.932       | 1.914        | 2.683            | 1.422             | 1.649   | 1.165     |
| L24 B4096 | 0.929       | 1.933        | 2.866            | 1.438             | 1.613   | 1.216     |
| L32 B1024 | 1.176       | 2.049        | 2.365            | 1.365             | 1.245   | 1.399     |
| L32 B2048 | 1.179       | 2.066        | 2.715            | 1.599             | 1.360   | 1.407     |
| L32 B4096 | 1.180       | 2.090        | 2.925            | 1.607             | 1.391   | 1.541     |
| L40 B1024 | 1.377       | 2.087        | 2.360            | 1.610             | 1.027   | 1.651     |
| L40 B2048 | 1.388       | 2.138        | 2.665            | 1.763             | 1.065   | 1.636     |
| L40 B4096 | 1.413       | 2.161        | 2.930            | 1.776             | 1.062   | 1.786     |


## Case 2 Data Center Spot

- Notes:
  - Use aws_run_megatron_heter_gpu_training.sh to run Megatron 
  - Use aws_run_gpt3_Ngpu_training.sh for ours w scheduler; 
  - Use aws_run_gpt3_scheduled_Ngpu_training.sh for ours wo scheduler;

- One iteration runtime (in seconds):

| Setting   | Megatron-T8 | Megatron-P4T2 | Megatron-P2T4 | Megatron-P8 |       |        | Ours w scheduler |        |        | Ours wo Scheduler |       |        | ZeRO S3 |        |        | Deepspeed PP |       |       |
|-----------|-------------|---------------|---------------|-------------|-------|--------|------------------|--------|--------|-------------------|-------|--------|---------|--------|--------|--------------|-------|-------|
| Seed      | -           | -             | -             |  2022       | 2023  | 2024   | 2022             | 2023   | 2024   | 2022              | 2023  | 2024   | 2022    | 2023   | 2024   | 2022         | 2023  | 2024  |   
| L24 B1024 | 265.42      | 48.48         | 118.99        | 21.31       | 21.79 | 20.79  | 12.33            | 12.35  | 12.38  | 15.30             | 14.99 | 14.96  | 28.25   | 28.27  | 27.64  | 19.06        | 19.26 | 18.60 |
| L24 B2048 | -           | -             | -             | 42.37       | 42.04 | 42.31  | 22.92            | 23.07  | 23.01  | 28.12             | 27.83 | 27.99  | 60.95   | 64.40  | 61.97  | 35.39        | 35.32 | 35.35 |
| L24 B4096 | -           | -             | -             | 83.57       | 83.05 | 83.93  | 45.24            | 45.17  | 45.59  | 53.72             | 53.56 | 52.47  | 114.51  | 118.46 | 123.29 | 68.57        | 68.30 | 68.09 |
| L32 B1024 | -           | -             | -             | 23.18       | 22.94 | 23.91  | 15.73            | 15.27  | 15.83  | 18.73             | 18.89 | 18.99  | 43.64   | 47.51  | 46.60  | 20.94        | 21.78 | 19.78 |
| L32 B2048 | -           | -             | -             | 43.68       | 44.45 | 43.57  | 28.97            | 28.98  | 28.70  | 33.48             | 32.23 | 34.20  | 85.38   | 87.56  | 86.76  | 38.85        | 38.58 | 38.85 |
| L32 B4096 | -           | -             | -             | 85.54       | 85.34 | 85.08  | 55.99            | 55.64  | 55.88  | 64.44             | 66.42 | 63.78  | 167.65  | 168.04 | 175.46 | 73.15        | 72.27 | 72.15 |
| L40 B1024 | -           | -             | -             | 25.29       | 25.34 | 25.39  | 18.43            | 18.60  | 18.44  | 21.67             | 22.61 | 20.74  | 59.32   | 56.36  | 58.69  | 22.79        | 23.07 | 23.94 |
| L40 B2048 | -           | -             | -             | 49.41       | 49.53 | 49.36  | 34.39            | 34.91  | 33.42  | 40.03             | 41.67 | 40.30  | 119.35  | 119.73 | 121.56 | 41.71        | 41.45 | 41.67 |
| L40 B4096 | -           | -             | -             | 96.16       | 96.06 | 95.68  | 67.23            | 66.90  | 68.23  | 77.20             | 79.32 | 77.23  | 240.13  | 241.07 | 247.69 | 79.16        | 79.58 | 79.73 |

- Hardware Efficiency (by PFlops):

| Setting    | Megatron-PP(Opt) | Ours w scheduler | Ours wo Scheduler | ZeRO S3 | Deepspeed |
|------------|------------------|------------------|-------------------|---------|-----------|
| L24 B1028  | 1.109            | 1.917            | 1.545             | 0.843   | 1.246     |
| L24 B2048  | 1.116            | 2.063            | 1.681             | 0.757   | 1.337     |
| L24 B4096  | 1.132            | 2.090            | 1.760             | 0.796   | 1.384     |
| L32 B1024  | 1.360            | 2.004            | 1.683             | 0.686   | 1.513     |
| L32 B2048  | 1.443            | 2.176            | 1.883             | 0.728   | 1.626     |
| L32 B4096  | 1.474            | 2.252            | 1.957             | 0.740   | 1.738     |
| L40 B1024  | 1.558            | 2.138            | 1.819             | 0.678   | 1.694     |
| L40 B2048  | 1.595            | 2.292            | 1.969             | 0.656   | 1.894     |
| L40 B4096  | 1.639            | 2.345            | 2.042             | 0.649   | 1.983     |


## Case 3 Multiple Universities

- Notes:
  - Generate tc scripts: aws_generate_heter_tc.sh 2 (case indexed from 0)
  - Use aws_run_gpt3_1gpu_training.sh for ours w scheduler(manually optimized); 
  - Use aws_run_gpt3_scheduled_1gpu_training.sh for ours wo scheduler;
  - Use aws_run_megatron_training.sh for different Megatron Settings.

- One iteration runtime

| Setting   | Megatron-P8 (Default) | Megatron-P8 (wo Scheduler) |         |         | Ours w scheduler |       |        | Ours wo Scheduler |       |       | ZeRO S3 |          |          | Deepspeed PP |        |        |
|-----------|-----------------------|----------------------------|---------|---------|------------------|-------|--------|-------------------|-------|-------|---------|----------|----------|--------------|--------|--------|
| Seed      | -                     | 2022                       | 2023    | 2024    | 2022             | 2023  | 2024   | 2022              | 2023  | 2024  | 2022    | 2023     | 2024     | 2022         | 2023   | 2024   |   
| L24 B1024 | 21.27                 | 33.72                      | 32.59   | 32.77   | 19.06            | 18.92 | 18.63  | 27.80             | 27.70 | 27.96 | 163.86  | 163.54   | 162.89   | 45.64        | 44.62  | 45.29  |
| L24 B2048 | 40.19                 | 59.69                      | 58.43   | 59.01   | 32.67            | 32.47 | 32.20  | 50.01             | 49.82 | 50.19 | 329.29  | 324.15   | 325.35   | 82.38        | 81.77  | 81.47  |
| L24 B4096 | 81.40                 | 111.31                     | 110.31  | 110.49  | 54.50            | 54.38 | 53.86  | 93.35             | 92.33 | 92.91 | 659.72  | 658.10   | 659.25   | 155.60       | 154.99 | 154.73 |
| L32 B1024 | 24.75                 | 33.98                      | 33.02   | 33.17   | 22.35            | 22.03 | 21.95  | 29.62             | 29.01 | 29.57 | 245.18  | 244.53   | 243.99   | 46.96        | 46.23  | 46.26  |
| L32 B2048 | 45.15                 | 60.17                      | 59.21   | 59.48   | 37.39            | 36.92 | 37.24  | 51.22             | 50.93 | 50.86 | 486.18  | 486.77   | 488.00   | 85.89        | 86.64  | 85.93  |
| L32 B4096 | 90.45                 | 112.40                     | 111.39  | 111.66  | 64.45            | 64.29 | 63.92  | 94.91             | 94.07 | 94.32 | 975.36  | 972.51   | 972.29   | 160.79       | 160.98 | 160.27 |
| L40 B1024 | 26.83                 | 37.01                      | 35.97   | 36.01   | 27.02            | 26.94 | 26.38  | 32.62             | 31.05 | 31.76 | 330.99  | 333.27   | 332.11   | 52.43        | 51.34  | 51.55  |
| L40 B2048 | 50.01                 | 65.06                      | 64.05   | 64.12   | 44.91            | 44.81 | 44.38  | 55.95             | 55.21 | 55.61 | 660.97  | 661.79   | 659.85   | 91.76        | 91.53  | 90.93  |
| L40 B4096 | 97.93                 | 121.98                     | 121.10  | 121.02  | 78.23            | 78.87 | 78.79  | 102.34            | 98.83 | 99.29 | 1325.62 | 1322.99  | 1327.24  | 172.93       | 173.18 | 172.80 |

- Hardware Efficiency (by PFlops):

| Setting    | Megatron-PP(Default) | Megatron-P8 (wo Scheduler) | Ours w scheduler | Ours wo Scheduler | ZeRO S3 | Deepspeed |
|------------|----------------------|----------------------------|------------------|-------------------|---------|-----------|
| L24 B1024  | 1.111                | 0.701                      | 1.240            | 0.850             | 0.145   | 0.523     |
| L24 B2048  | 1.176                | 0.792                      | 1.447            | 0.945             | 0.145   | 0.577     |
| L24 B4096  | 1.162                | 0.850                      | 1.735            | 1.013             | 0.143   | 0.610     |
| L32 B1024  | 1.274                | 0.928                      | 1.410            | 1.064             | 0.129   | 0.678     |
| L32 B2048  | 1.396                | 1.048                      | 1.686            | 1.231             | 0.129   | 0.732     |
| L32 B4096  | 1.394                | 1.122                      | 1.956            | 1.328             | 0.130   | 0.785     |
| L40 B1024  | 1.469                | 1.065                      | 1.459            | 1.208             | 0.119   | 0.761     |
| L40 B2048  | 1.576                | 1.211                      | 1.755            | 1.409             | 0.119   | 0.862     |
| L40 B4096  | 1.610                | 1.292                      | 2.015            | 1.540             | 0.119   | 0.911     |


## Case 4 Regional Distributed

- Notes:
  - Generate tc scripts: aws_generate_heter_tc.sh 3 (case indexed from 0)
  - Use aws_run_gpt3_1gpu_training.sh for ours w scheduler(manually optimized); 
  - Use aws_run_gpt3_scheduled_1gpu_training.sh for ours wo scheduler;
  - Use aws_run_megatron_training.sh for different Megatron Settings.

- One iteration runtime 

| Setting   | Megatron-P8 (Default)  | Megatron-P8 (wo Scheduler) |         |         | Ours w scheduler |        |        | Ours wo Scheduler |        |        | ZeRO S3 |         |         | Deepspeed PP |        |        |
|-----------|------------------------|----------------------------|---------|---------|------------------|--------|--------|-------------------|--------|--------|---------|---------|---------|--------------|--------|--------|
| Seed      | -                      | 2022                       | 2023    | 2024    | 2022             | 2023   | 2024   | 2022              | 2023   | 2024   | 2022    | 2023    | 2024    | 2022         | 2023   | 2024   |
| L24 B1024 | 38.77                  | 56.20                      | 62.36   | 59.76   | 22.24            | 21.85  | 21.81  | 31.99             | 31.77  | 31.96  | 240.39  | 240.01  | 240.44  | 50.38        | 49.44  | 49.77  |
| L24 B2048 | 72.91                  | 102.08                     | 106.41  | 104.93  | 38.68            | 38.36  | 38.41  | 57.07             | 56.98  | 57.01  | 475.80  | 481.59  | 480.94  | 87.73        | 86.94  | 86.66  |
| L24 B4096 | 141.71                 | 193.72                     | 197.92  | 195.62  | 72.02            | 71.76  | 71.76  | 106.12            | 105.76 | 106.02 | 956.61  | 957.95  | 959.64  | 162.71       | 162.03 | 151.88 |
| L32 B1024 | 42.59                  | 60.31                      | 64.82   | 63.51   | 26.24            | 26.01  | 25.97  | 33.78             | 33.62  | 33.59  | 551.35  | 551.96  | 555.67  | 54.88        | 53.45  | 54.86  |
| L32 B2048 | 79.96                  | 108.64                     | 112.52  | 111.90  | 45.66            | 45.76  | 45.38  | 58.42             | 58.54  | 58.60  | 1110.51 | 1096.01 | 1102.59 | 93.11        | 92.50  | 93.69  |
| L32 B4096 | 151.56                 | 206.11                     | 211.91  | 209.05  | 86.07            | 85.73  | 85.79  | 108.91            | 107.81 | 108.21 | 2198.83 | 2212.89 | 2195.66 | 178.77       | 177.35 | 176.68 |
| L40 B1024 | 46.63                  | 63.86                      | 69.48   | 66.63   | 31.69            | 31.43  | 31.38  | 37.62             | 37.43  | 37.39  | 841.98  | 847.14  | 846.81  | 58.93        | 57.70  | 58.92  |
| L40 B2048 | 85.65                  | 114.33                     | 120.37  | 117.03  | 51.75            | 51.55  | 51.45  | 63.58             | 62.12  | 62.48  | 1676.73 | 1673.10 | 1669.82 | 97.82        | 99.08  | 99.18  |
| L40 B4096 | 164.77                 | 216.38                     | 221.44  | 218.43  | 95.46            | 95.15  | 95.11  | 115.90            | 112.34 | 113.74 | 3377.49 | 3367.26 | 3348.84 | 189.82       | 187.35 | 188.14 |

- Hardware Efficiency (by PFlops):

| Setting   | Megatron-PP (Default) | Megatron-P8 (wo Scheduler) | Ours w scheduler | Ours wo Scheduler | ZeRO S3 | Deepspeed |
|-----------|-----------------------|----------------------------|------------------|-------------------|---------|-----------|
| L24 B1024 | 0.610                 | 0.421                      | 1.063            | 0.739             | 0.098   | 0.474     | 
| L24 B2048 | 0.648                 | 0.463                      | 1.222            | 0.828             | 0.099   | 0.543     |
| L24 B4096 | 0.667                 | 0.488                      | 1.313            | 0.891             | 0.099   | 0.595     |
| L32 B1024 | 0.740                 | 0.523                      | 1.201            | 0.933             | 0.057   | 0.579     |
| L32 B2048 | 0.788                 | 0.580                      | 1.381            | 1.079             | 0.057   | 0.677     |
| L32 B4096 | 0.832                 | 0.612                      | 1.465            | 1.158             | 0.057   | 0.710     |
| L40 B1024 | 0.845                 | 0.617                      | 1.244            | 1.048             | 0.047   | 0.673     |
| L40 B2048 | 0.920                 | 0.689                      | 1.523            | 1.240             | 0.047   | 0.799     |
| L40 B4096 | 0.957                 | 0.729                      | 1.651            | 1.360             | 0.047   | 0.837     |


## Case 5 World-wide Distributed 

- Notes:
  - Generate tc scripts: aws_generate_heter_tc.sh 4 (case indexed from 0)
  - Use aws_run_gpt3_1gpu_training.sh for ours w scheduler(manually optimized); 
  - Use aws_run_gpt3_scheduled_1gpu_training.sh for ours wo scheduler;
  - Use aws_run_megatron_training.sh for different Megatron Settings.

- One iteration runtime 

| Setting   | Megatron-P8 (Default) | Megatron-P8 (wo Scheduler) |         |         | Ours w scheduler |         |         | Ours wo Scheduler |        |         | Deepspeed S3 |          |         | Deepspeed PP |        |        |
|-----------|-----------------------|----------------------------|---------|---------|------------------|---------|---------|-------------------|--------|---------|--------------|----------|---------|--------------|--------|--------|
| Seed      | -                     | 2022                       | 2023    | 2024    | 2022             | 2023    | 2024    | 2022              | 2023   | 2024    | 2022         | 2023     | 2024    | 2022         | 2023   | 2024   |
| L24 B1024 | 83.04                 | 167.74                     | 164.38  | 164.63  | 43.78            | 44.39   | 43.87   | 92.29             | 89.64  | 93.46   | 589.43       | 584.14   | 577.56  | 135.96       | 130.20 | 128.89 |
| L24 B2048 | 156.93                | 301.30                     | 297.88  | 298.45  | 62.27            | 62.90   | 62.59   | 165.89            | 162.10 | 163.80  | 1158.05      | 1143.81  | 1209.49 | 228.45       | 227.99 | 222.08 |
| L24 B4096 | 307.79                | 572.48                     | 569.22  | 569.25  | 104.06           | 104.53  | 104.08  | 313.63            | 308.01 | 315.88  | 2375.95      | 2383.01  | 2377.42 | 412.02       | 408.92 | 407.61 |
| L32 B1024 | 85.97                 | 180.11                     | 176.51  | 176.91  | 51.06            | 51.63   | 51.13   | 99.10             | 97.21  | 99.50   | 1106.35      | 1105.22  | 1100.08 | 140.91       | 138.78 | 141.85 |
| L32 B2048 | 165.14                | 313.90                     | 310.85  | 311.32  | 71.96            | 72.46   | 72.02   | 172.54            | 165.46 | 168.49  | 2251.42      | 2203.13  | 2138.95 | 239.38       | 237.94 | 232.83 |
| L32 B4096 | 327.65                | 584.52                     | 580.88  | 581.78  | 114.01           | 114.57  | 113.91  | 320.63            | 311.32 | 324.41  | 4360.72      | 4430.44  | 4393.58 | 435.90       | 427.94 | 423.14 |
| L40 B1024 | 89.35                 | 188.17                     | 184.87  | 185.69  | 58.24            | 58.92   | 58.55   | 106.71            | 100.61 | 108.18  | 1666.32      | 1647.07  | 1657.18 | 150.31       | 149.27 | 147.79 |
| L40 B2048 | 171.95                | 326.02                     | 322.29  | 322.66  | 80.68            | 81.34   | 80.92   | 181.16            | 171.87 | 181.80  | 3223.25      | 3202.50  | 3241.68 | 260.81       | 258.57 | 255.64 |
| L40 B4096 | 337.69                | 595.64                     | 591.08  | 592.07  | 124.07           | 124.56  | 124.23  | 331.25            | 313.98 | 335.31  | 6799.17      | 6727.32  | 6510.85 | 449.67       | 446.91 | 439.55 |

- Hardware Efficiency (by PFlops):

| Setting    | Megatron-PP(Default) | Megatron-P8 (wo Scheduler) | Ours w scheduler | Ours wo Scheduler | ZeRO S3 | Deepspeed |
|------------|----------------------|----------------------------|------------------|-------------------|---------|-----------|
| L24 B1024  | 0.285                | 0.141                      | 0.540            | 0.256             | 0.040   | 0.180     |
| L24 B2048  | 0.301                | 0.157                      | 0.759            | 0.285             | 0.040   | 0.209     |
| L24 B4096  | 0.307                | 0.165                      | 0.909            | 0.302             | 0.040   | 0.231     |
| L32 B1024  | 0.367                | 0.175                      | 0.617            | 0.318             | 0.029   | 0.224     |
| L32 B2048  | 0.382                | 0.201                      | 0.876            | 0.365             | 0.029   | 0.266     |
| L32 B4096  | 0.385                | 0.216                      | 1.106            | 0.393             | 0.029   | 0.294     |
| L40 B1024  | 0.441                | 0.209                      | 0.677            | 0.369             | 0.024   | 0.264     |
| L40 B2048  | 0.458                | 0.242                      | 0.977            | 0.435             | 0.024   | 0.305     |
| L40 B4096  | 0.467                | 0.265                      | 1.271            | 0.476             | 0.024   | 0.354     |


## FluidStack Run (Two Region)

- Notes:
  - Two FluidStack Region: East and Middle (8 nodes in East, 8 nodes in Middle)
  - Machine Spec:
    - A40 GPU: 150 TFPOLS; 48 GB RAM
    - 128 RAM
    - 8 Core
  - Additional PFLOP:
    - GPT3-6.7B Batch size 1024: 117.12
    - GPT3-13B Batch size 1024: 225.23

  - Intra region delay: 0.5 ms
  - Cross region delay: 20 ms

  - Intra region bandwidth: 
    - east: 9.5 Gbps
    - mid: 10.5 Gbps
  - Cross region bandwidth: 
    - mid to east: 3.34 Gbps
    - east to mid: 3.03 Gbps

- Running time:

| Setting         | Megatron-P8 (Default) | Megatron-P8 (wo Scheduler) |        |        | Ours w scheduler |         |         | Ours wo Scheduler-Fair |         |         | Ours wo Scheduler-complete |        |        |
|-----------------|-----------------------|----------------------------|--------|--------|------------------|---------|---------|------------------------|---------|---------|----------------------------|--------|--------|
| Seed            | -                     | 2022                       | 2023   | 2024   | 2022             | 2023    | 2024    | 2022                   | 2023    | 2024    | 2022                       | 2023   | 2024   |
| L24 B1024       | 51.32                 | 88.58                      | 91.93  | 87.47  | 30.36            | 29.07   | 27.29   | 60.47                  | 65.07   | 64.94   | 86.99                      | 90.26  | 93.01  |
| L24 B2048       | -                     | 170.61                     | 171.93 | 172.14 | 49.63            | 46.35   | 43.95   | 128.44                 | 136.02  | 131.40  | 180.96                     | 181.42 | 189.89 |
| L24 B4096       | -                     | 338.18                     | 342.43 | 339.13 | 78.78            | 80.36   | 77.82   | 239.03                 | 260.18  | 238.95  | 356.17                     | 332.19 | 343.46 | 
| L32 B1024       | -                     | 91.32                      | 99.08  | 101.31 | 34.99            | 41.16   | 38.41   | 76.09                  | 74.37   | 76.60   | 102.08                     | 105.90 | 96.15  | 
| L32 B2048       | -                     | 181.94                     | 176.85 | 180.91 | 61.04            | 57.26   | 57.54   | 139.67                 | 152.66  | 138.20  | 189.53                     | 202.45 | 178.67 | 
| L32 B4096       | -                     | 340.69                     | 339.51 | 349.33 | 99.16            | 97.87   | 99.89   | 272.30                 | 288.62  | 277.66  | 380.48                     | 395.48 | 385.51 |
| L40 B1024       | -                     | 98.84                      | 100.04 | 98.08  | 43.60            | 45.75   | 46.90   | 85.38                  | 81.34   | 81.93   | 111.53                     | 106.37 | 115.06 | 
| L40 B2048       | -                     | 188.04                     | 184.91 | 186.09 | 72.30            | 75.17   | 72.98   | 163.87                 | 166.36  | 152.61  | 200.81                     | 198.98 | 207.09 | 
| L40 B4096       | -                     | 346.91                     | 343.96 | 365.08 | 120.61           | 120.95  | 118.19  | 315.21                 | 305.77  | 317.29  | 403.06                     | 399.57 | 392.77 | 
 | GPT3-6.7B B1024 | -                     | 189.38                     | 193.13 | 185.08 | 92.29            | 95.23   | 90.74   | 175.15                 | 177.50  | 169.35  | -                          | -      | -      |
| GPT3-13B B1024  | -                     | 283.38                     | 292.82 | 288.93 | 150.39           | 160.70  | 164.07  | 277.92                 | 268.00  | 282.59  | -                          | -      | -      |

- Hardware Efficiency (by PFlops):
  - Peak PFlops of the cluster: 4.79 PFLOPS.

| Setting         | Megatron-P8 (wo Scheduler) | Ours w scheduler | Efficiency | Ours wo Scheduler |
|-----------------|----------------------------|------------------|------------|-------------------|
| L24 B1024       | 0.265                      | 0.818            | 17.1%      | 0.372             |
| L24 B2048       | 0.276                      | 1.014            | 21.2%      | 0.358             |
| L24 B4096       | 0.278                      | 1.197            | 24.9%      | 0.384             |
| L32 B1024       | 0.324                      | 0.825            | 17.2%      | 0.416             |
| L32 B2048       | 0.351                      | 1.076            | 22.4%      | 0.439             |
| L32 B4096       | 0.367                      | 1.274            | 26.6%      | 0.451             |
| L40 B1024       | 0.398                      | 0.868            | 18.1%      | 0.475             |
| L40 B2048       | 0.423                      | 1.073            | 22.4%      | 0.490             |
| L40 B4096       | 0.448                      | 1.315            | 27.4%      | 0.504             |
| GPT3-6.7B B1024 | 0.619                      | 1.26             | 26.4%      | 0.673             |
| GPT3-13B B1024  | 0.781                      | 1.42             | 29.7%      | 0.815             |


- Communication Matrices:

| 	          | Average  | Std   |
|------------|----------|-------|
| Intra-mid  | 10.40    | 1.11  |
| Intra-east | 11.98    | 1.98  |
| mid-east   | 3.87     | 1.07  |
| east-mid   | 3.72     | 1.38  |



## FluidStack Run (Three Region)

- Notes:
  - Same machine setup as above
  - 

- Communication Matrix
- Delay:

|      | East    | Mid      | West     |
|------|---------|----------|----------|
| East | -       | 21.8 ms  | 60.2 ms  |
| Mid  | 21.8 ms | -        | 39.7 ms  |
| West | 60.2 ms | 39.7 ms  | -        |


- Bandwidth:

|             | East (send) | Mid (send) | West  (send) |
|-------------|-------------|------------|--------------|
| East (recv) | -           | 3.04 Gbps  | 1.17 Gbps    |
| Mid (recv)  | 3.10 Gbps   | -          | 1.78 Gbps    |
| West(recv)  | 0.15 Gbps   | 0.16 Gbps  | -            |


- Running time:

| Setting          | Ours w scheduler |        |        |
|------------------|------------------|--------|--------|
| Seed             | 2022             | 2023   | 2024   |
| L24 B1536        | 42.24            | 45.83  | 44.18  |
| L24 B3072        | 70.64            | 65.35  | 59.24  |
| L24 B6144        | 104.13           | 96.67  | 97.13  |
| L32 B1536        | 58.48            | 51.35  | 49.67  |
| L32 B3072        | 124.22           | 118.08 | 120.69 |
| L32 B6144        | 120.69           | 130.76 | 124.22 |
| L40 B1536        | 64.21            | 61.79  | 69.86  |
| L40 B3072        | -                | -      | -      |
| L40 B6144        | 149.06           | 140.05 | 142.51 | 
 | GPT3-6.7B B1536  | -                | -      | -      |
 | GPT3-13B B1536   | 269.22           | 264.43 | 288.27 |


- Hardware Efficiency (by PFlops):

| Setting          | Ours w scheduler | 
|------------------|------------------|
| L24 B1536        | 0.804            | 
| L24 B3072        | 1.089            |
| L24 B6144        | 1.428            | 
| L32 B1536        | 0.889            | 
| L32 B3072        | 0.782            |  
| L32 B6144        | 1.510            | 
| L40 B1536        | 0.905            | 
| L40 B3072        | -                |
| L40 B6144        | 1.644            |
 | GPT3-6.7B B1536  | -                |
 | GPT3-13B B1536   | 1.23             |